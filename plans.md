## 1. 全体像 (Big Picture)

### 目的 (Goal)
iLovePDF風の操作体験を持つPDF編集UIをReact/Tailwindベースのフロントエンドに実装し、ユーザーが直感的にページの並べ替え・分割・結合といった操作を行えるようにする。

### 背景 (Context)
既存のPaper ForgeフロントエンドにはPDF編集のワークスペースがあるが、操作性やフィードバックが十分に整理されていない。iLovePDFに近いUXを研究しつつ、Paper Forgeらしいビジュアルスタイルを維持しながらサムネイルグリッドやアクションバー、Undo/Redoといったインタラクションを設計し直す必要がある。サーバー側のPDF操作APIとの整合を図りつつ、React QueryやZustandなど既存スタックを活用する。

---

## 2. ToDoリストと進捗 (To-Do List & Progress)

### ToDo (待機中/未着手)
- [x] iLovePDFにおけるページ並べ替え・分割・結合フローとUIパターンを資料化する
- [x] 現行PDF編集画面とバックエンドAPIが並べ替え・分割・結合をどこまでサポートしているかギャップ分析する
- [x] Paper Forgeブランドを維持したまま新しいサムネイル/ツールバー/モーダル構成案をまとめる
- [ ] 不足するバックエンド機能の追加要否を含め、必要な技術要件と依存タスクをステークホルダーと合意する

### Progress (自動更新される進捗状況)

#### 完了した主要項目 (Checked Off Big Items) [3]
- 未完了

#### 現在の作業ステータス [2]
実装フェーズ中盤: 並べ替え・分割・結合の統合ワークスペースを整備し、トースト/履歴によるフィードバックを導入済み。次はUndo/Redo設計とバックエンド拡張の検討に移行。

---

## 3. 実行ステップ (Implementation & Execution Steps)

### A. スパイク/リサーチ (Spikes/Research) [4]
- [x] iLovePDFの主要画面（ページ並べ替え、分割、結合）の操作ステップとUI要素を観察・記録する
- [x] Paper Forgeの現行PDF編集フローと状態管理（React Query + Zustand）の制約を調査する
- [x] PDF操作APIの能力（ページ単位の並べ替え/分割/結合）の確認と不足機能の洗い出し

**リサーチメモ**
- iLovePDFではアップロード直後にサムネイルグリッドが表示され、複数選択＋ドラッグで並べ替え、右側アクションバーで削除・分割・結合を操作。Undo/Redoと選択状態のフィードバックが常時表示される。
- Paper Forge現行UIはフォーム入力中心でサムネイルプレビューがなく、バックエンドは`order`配列や`ranges`文字列を受け付けるのみ。分割は範囲テキスト、結合は複数ファイルアップロードに限定されている。
- ギャップ: ページプレビュー生成APIが存在しない／フロントでPDFレンダリングを行っていない、Undo/Redoログがない、複数ファイルを視覚的に並べるUIが不足。

### B. 実装フェーズ (Feature Implementation) [4]
- [x] フロントエンドの編集レイアウトを再設計し、サムネイルグリッド・操作バー・プレビュー領域を構築する
- [x] Drag & Dropベースのページ並べ替えと複数選択操作を実装し、SortableJSなど既存依存を活用する
- [x] ページ分割フロー用のUI（選択範囲 → 範囲文字列、ZIP出力）を実装し、既存スタイルガイドに沿って整理する
- [x] ページ結合フロー用のUI（複数ファイル投入、並べ替え、追加操作）を実装し、統合ワークスペースへ組み込む
- [ ] 必要に応じてバックエンドに並べ替え・分割・結合APIを追加/拡張し、フロントエンドから呼び出す
- [x] 進行状況・エラー・成功トーストなどのフィードバックメカニズムを作成し、Undo/Redoや履歴UIを組み込む（履歴パネル/トーストを実装済み、Undo/Redoは次期タスクで検討）
- [ ] バックエンドAPIとの結合テストを通じてページ操作結果を保存・反映する

### C. ドキュメントおよびテスト (Documentation & Tests) [3, 4]
- [ ] 並べ替え・分割・結合作業をカバーするUIコンポーネントの単体テストと主要フローのE2Eテストを追加する
- [ ] `README.md` またはユーザードキュメントに新しい操作手順（並べ替え・分割・結合）を追記する
- [ ] 内部向けナレッジベース/設計ドキュメントを更新し、UXガイドラインとデザイン原則を共有する

---

## 4. 決定ログ (Decision Log) [2]

| 日付 | 決定事項 | 理由 |
| :--- | :--- | :--- |
| 2025/02/14 | 優先リデザイン対象をページ並べ替え・分割・結合操作に限定する | ユーザーからの優先度指定 |
| 2025/02/14 | Paper Forgeの既存UIスタイルを維持しつつUXのみiLovePDFを参照する | ブランド一貫性を確保するため |
| 2025/02/14 | バックエンド機能は不足時に拡張する方針 | 現行APIの制約を踏まえて柔軟に対応するため |

---

## 5. 驚きと発見 (Surprises and Discoveries) [2]
- 未発生

---

## 6. エグゼクティブサマリー (Executive Summary) [3]
[作業完了後に更新予定。]
